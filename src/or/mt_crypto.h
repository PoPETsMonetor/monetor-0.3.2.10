/**
 * \file mt_crypto.h
 * \brief Header file for mt_crypto.c
 *
 * All functions return MT_SUCCESS/MT_ERROR unless void or otherwise stated.
 **/

#ifndef mt_crypto_h
#define mt_crypto_h

#include "or.h"

/********************** Hardcoded Public Parameters *********************/

#define MT_PP_HEX "0xF8A25B7E55D57E194A7EDC3DD6D072C677136060E22E71C454334B3D5B97BF2BB6904B9F5FC60606EB482B0007242C1054A6563ED4D8C47D3215EBBD63416498FEBEEBBE843457C461E8E8C99463B871D086C9919060243B4D03165E1836E22E2D3492C755B097BEF95B929F2D9AC2EE8F23912D6B791BF2F4C5B5E46D43D409"

#define MT_FAUCET_PK_HEX "0x2D2D2D2D2D424547494E205055424C4943204B45592D2D2D2D2D0A4D4947664D413047435371475349623344514542415155414134474E4144434269514B426751436B3246464C70503571506A31336B78714C384A4A6C343555440A6663695A67722B683531306C6E444E4A746C6E6277424A544C5851446E77683272754F6979336E2F59636E6E7478354F684933764459634A56374148683763380A37426E4B416F705059414977706134476E375341363574616E777573366F46396A6A745438485255743368776C544F2B7052326362396C557A416279594864550A652F68317162546A52596E646636585559774944415141420A2D2D2D2D2D454E44205055424C4943204B45592D2D2D2D2D0A00"

#define MT_FAUCET_SK_HEX "0x2D2D2D2D2D424547494E205253412050524956415445204B45592D2D2D2D2D0A4D4949435841494241414B426751436B3246464C70503571506A31336B78714C384A4A6C343555446663695A67722B683531306C6E444E4A746C6E6277424A540A4C5851446E77683272754F6979336E2F59636E6E7478354F684933764459634A563741486837633837426E4B416F705059414977706134476E375341363574610A6E777573366F46396A6A745438485255743368776C544F2B7052326362396C557A41627959486455652F68317162546A52596E646636585559774944415141420A416F47414B6D53504535734D36706D7A43517446716E4E6C30746F694F6C476777776E43366F6F726844365657674752506C6734336A6330504C49725A516F340A3947624C7177656B2B7667327A5135397964703676635A564F4643694872356F524A445168385157444150474A506655395A576C6E6F673350786579465A2B680A31367530327053786A7449343257536F6A544261773833336C476974446437773456616B436B6B4B756D52462B744543515144627778782F47546F5A61772F790A567550346A70524D6A4C572F43436170742B673253424863386F49385363504533393766474344366349675A76693936376B68756D33774846553275705556550A68616F7A7A527658416B4541774162346839387846533948594E4A6C4B674778324D4C7156564D6877356E55385454667A626F55756364424871534C73794C430A764773434A2F333633656B4753716E56696C4B376563394B6F4963375451356156514A414448444A4A6A444A5A7A4C3258694F7047434D4B4A694D35447131700A6375596B55523558564969743872664353317A5A417777636F64444A4135774F6D416A784E4D47386A62495A43612F3163736C325479526E56514A42414B2B4E0A372B7276376F534B6D377631765930417A614834324A6B33446A67767A4244556F514D493675664A4E55795A624370535469784A764566706C3038484F62784B0A746A486D587755477352672F61635352715A3043514532474C594B734B596B32505842546436564367774973343145486B75727A6847744C4F463775633962500A7833515652434246645A786541352B7563376E356136376766427338422F45306C4A7A414337426E6337513D0A2D2D2D2D2D454E44205253412050524956415445204B45592D2D2D2D2D0A0082FBDBEE4F"

#define MT_AUT_PK_HEX "0x2D2D2D2D2D424547494E205055424C4943204B45592D2D2D2D2D0A4D4947664D413047435371475349623344514542415155414134474E4144434269514B426751437533476561616939566B4B54646F43456849472B6B5A6564460A54444D6B4953676336384C6A2B58356B4556746843424E484C69612B416F777669445636464B752B6A546466686E76414441763535646F753557475577364A340A58546C516E546B6C4E4B446C557238624766634A34565A3542492F4C6C4B304D7876484238645537774A712F345563756E68577453426F5A4D6E534E6D6D64340A4E68484433492B4B636A6D536F57686645514944415141420A2D2D2D2D2D454E44205055424C4943204B45592D2D2D2D2D0A00"

#define MT_AUT_SK_HEX "0x2D2D2D2D2D424547494E205253412050524956415445204B45592D2D2D2D2D0A4D4949435867494241414B426751437533476561616939566B4B54646F43456849472B6B5A65644654444D6B4953676336384C6A2B58356B4556746843424E480A4C69612B416F777669445636464B752B6A546466686E76414441763535646F753557475577364A3458546C516E546B6C4E4B446C557238624766634A34565A350A42492F4C6C4B304D7876484238645537774A712F345563756E68577453426F5A4D6E534E6D6D64344E68484433492B4B636A6D536F57686645514944415141420A416F4742414A4D315945386946386C634A542B6A5947436F4576542F43533151306A6B585A4E4B384E4732436A45496F5470716F6C726F31413036786A46307A0A75586D575432507A4E4F764A70774C7434574D33653342426B647972524B446F535062653968356D686434664342763544644744445861456A544D6E737149420A446255425178422B4A466D77347038473059316C6B754B534173594E6C6735496F4F41344C4A2F707066554844783942416B454135644C3755743850653175510A79747A4366314D4879673263665A4151396E6D57454F2B6E5572786A6E556A483836552B517A374374594C684A5255555238756A597170656F395A75495639420A376743675259532F53514A42414D4C47326B6B4978464B56783472636C786C4F3234374976486C434537702B705874533765764670634450386A7169586C4D6A0A56446C6854374F33464D38586E3750397A4D707766486C3831544279344D54512B596B435151434B645668616265354B324468634C7A47794F5A6959767969480A63524C33477673777975455964457A6A5269544967635949427A6951312F2F434D6E66635A532F53306D6466393243304645714A453746374547575A416B414A0A346362665837642B4C53557A6B562B464A44415666572B36677A533343496669797546525466544C354944346F705A4168354656572B2B4D5161536E6F5234300A4A704E475468437970546533766F78537A2F7470416B454177442F4B7738665543734464384A754A2B633749302B506B4E6964695630754A3942556D3532534F0A6D37572B69432B4268422B554A496B636C6C386D6C38617A5078796366395A684B387266324D784438412B7562513D3D0A2D2D2D2D2D454E44205253412050524956415445204B45592D2D2D2D2D0A002D"

/************************************************************************/

typedef enum {
  MT_ZKP_TYPE_1,
  MT_ZKP_TYPE_2,
  MT_ZKP_TYPE_3,
} mt_zkp_type_t;

/**
 * Generate the public parameters needed to run the
 * commitment/zero-knowledge proof schemes
 */
int mt_crypt_setup(byte (*pp_out)[MT_SZ_PP]);

/**
 * Generate a public/private RSA keypair given public parameters
 */
int mt_crypt_keygen(byte (*pp)[MT_SZ_PP], byte (*pk_out)[MT_SZ_PK], byte (*sk_out)[MT_SZ_SK]);

/**
 * Fill the given byte string with cryptographically secure random
 * bytes of the given size.
 */
int mt_crypt_rand(int size, byte* rand_out);

/**
 * Generate a SHA256 hash digest of the given byte string message
 */
int mt_crypt_hash(byte* msg, int msg_size, byte (*hash_out)[MT_SZ_HASH]);

/******************************* Signature ******************************/

/**
 * Generate signature on a byte string message
 */
int mt_sig_sign(byte* msg, int msg_size, byte (*sk)[MT_SZ_SK], byte (*sig_out)[MT_SZ_SIG]);

/**
 * Verify the signature on a byte string message
 */
int mt_sig_verify(byte* msg, int msg_size, byte (*pk)[MT_SZ_PK], byte (*sig)[MT_SZ_SIG]);

/******************************* Committment ****************************/

/**
 * Generate a committment on a byte string message and randomness
 */
int mt_com_commit(byte* msg, int msg_size, byte (*rand)[MT_SZ_HASH],  byte (*com_out)[MT_SZ_COM]);

/**
 * Verify committment on the original message and randomness
 */
int mt_com_decommit(byte* msg, int msg_size, byte (*rand)[MT_SZ_HASH], byte (*com)[MT_SZ_COM]);


/****************************** Blind Signature *************************/

/**
 * Generate a blinded version of the given message that can be signed
 * using a compatible signature scheme
 */
int mt_bsig_blind(byte* msg, int msg_size, byte (*pk)[MT_SZ_PK], byte (*blinded_out)[MT_SZ_BL],
		byte(*unblinder_out)[MT_SZ_UBLR]);

/**
 * Given a signature on a blinded message, unblind the signature so
 * that it can be verified against the original message.
 */
int mt_bsig_unblind(byte (*pk)[MT_SZ_PK], byte (*blinded_sig)[MT_SZ_SIG], byte (*unblinder)[MT_SZ_UBLR],
		  byte (*unblinded_sig_out)[MT_SZ_SIG]);

/**
 * Verify an unblinded signature on the original message.
 */
int mt_bsig_verify(byte* msg, int msg_size, byte (*pk)[MT_SZ_PK], byte (*unblinded_sig)[MT_SZ_SIG]);

/*************************** Zero-Knowledge Proof ***********************/

/**
 * Generate a zero-knowledge proof of some encoded statement given
 * some inputs.
 */
int mt_zkp_prove(mt_zkp_type_t type, byte (*pp)[MT_SZ_PP],
		 byte* hidden_inputs, int hidden_size,
		 byte* public_inputs, int public_size,
		 byte (*zkp_out)[MT_SZ_ZKP]);

/**
 * Verify a zero-knowledge proof.
 */
int mt_zkp_verify(mt_zkp_type_t type, byte (*pp)[MT_SZ_PP],
		  byte* public_inputs, int public_size,
		  byte (*zkp)[MT_SZ_ZKP]);

#endif
